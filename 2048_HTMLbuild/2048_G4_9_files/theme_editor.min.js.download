(function(){var ImagePicker,ImageUpload,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ImageUpload=function(superClass){extend(ImageUpload,superClass);function ImageUpload(){return ImageUpload.__super__.constructor.apply(this,arguments)}ImageUpload.prototype.success_params={type:"layout",thumb_size:"original"};return ImageUpload}(I.ImageUpload);ImagePicker=function(){function ImagePicker(el,editor,update){this.editor=editor;if(update==null){update=null}if(update){this.update=update}this.el=$(el);this.make_upload_btn();this.el.dispatch("click",{remove_image_btn:function(_this){return function(btn){_this.el.removeClass("has_image").find(".image_preview").css("background-image","").end().find(".image_id_input").val("").end().data("image_url","");return _this.send_update()}}(this)});this.el.on("change",function(_this){return function(e){return _this.send_update()}}(this));this.send_update()}ImagePicker.prototype.upload_prefix=function(){return this.editor.upload_prefix()};ImagePicker.prototype.prepare_upload=function(fn){return typeof fn==="function"?fn():void 0};ImagePicker.prototype.update=function(){};ImagePicker.prototype.send_update=function(){var i,len,name,option,opts,ref,url;name=this.el.data("image_name");url=this.el.data("image_url");if(!url){return this.update(name,void 0)}opts={url:url};ref=this.el.find(".image_option");for(i=0,len=ref.length;i<len;i++){option=ref[i];option=$(option);opts[option.data("name")]=option.find("select").val()}return this.update(name,opts)};ImagePicker.prototype.make_upload_btn=function(){var btn;if(this.upload_btn){return}this.progress_inner||(this.progress_inner=this.el.find(".progress_inner"));btn=this.el.find(".upload_image_btn");return this.upload_btn=I.make_popup_upload_button(this,btn,ImageUpload,{start_uploading:function(_this){return function(){_this.progress_inner.css({width:""});return _this.el.addClass("uploading")}}(this),finish_upload:function(_this){return function(upload,file){_this.el.removeClass("uploading").addClass("has_image").find(".image_preview").css("background-image","url("+file.url+")").end().find(".image_id_input").val(file.id).end().data("image_url",file.url);return _this.send_update()}}(this)})};return ImagePicker}();I.AppearanceEditor=function(){AppearanceEditor.ImageUpload=ImageUpload;AppearanceEditor.ImagePicker=ImagePicker;function AppearanceEditor(el,data){this.data=data;this.set_height=bind(this.set_height,this);this.css_template=bind(this.css_template,this);this.el=$(el);this.style=_.extend({},this.data);this.refresh_style=_.debounce(function(_this){return function(){return _this.constructor.prototype.refresh_style.apply(_this,arguments)}}(this),0);this.setup_color_picker();this.setup_image_picker();this.setup_text_areas();this.setup_form();this.el.dispatch("click",{toggle_editor_btn:function(_this){return function(){return _this.toggle()}}(this)});if(window.location.hash.match(/\bedit\b/)){_.defer(function(_this){return function(){return _this.toggle()}}(this))}$(window).on("resize",_.debounce(function(_this){return function(){return _this.set_height()}}(this),100))}AppearanceEditor.prototype.css_template=function(){var template_code;if(!this.css_template_fn){template_code=this.el.data("css_template");if(!template_code){return}this.css_template_fn=eval(template_code)}return this.css_template_fn.apply(this,arguments)};AppearanceEditor.prototype.set_height=function(){var html_h,inner,inner_h,real_height,win_h;inner=this.el.find(".appearance_editor_inner");html_h=$("html").outerHeight(true);win_h=$(window).height();inner_h=inner.outerHeight(true);if(inner_h>win_h){real_height=Math.max(html_h,win_h,inner_h);return this.el.height(real_height).css({bottom:"",position:""})}else{return this.el.height("").css({bottom:"0",position:"fixed"})}};AppearanceEditor.prototype.toggle=function(){var body;body=$(document.body).toggleClass("show_appearance_editor");this.set_height();this.el.addClass("animating");return setTimeout(function(_this){return function(){_this.el.removeClass("animating");return _this.set_height()}}(this),200)};AppearanceEditor.prototype.refresh_style=function(){};AppearanceEditor.prototype.upload_prefix=function(){throw"override me"};AppearanceEditor.prototype.update_image=function(name,image){this.style[name]=image;return this.refresh_style()};AppearanceEditor.prototype.update_color=function(name,color){this.style[name]=color;return this.refresh_style()};AppearanceEditor.prototype.setup_form=function(){return this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){alert(res.errors.join(", "))}}}(this))};AppearanceEditor.prototype.setup_text_areas=function(){return this.el.on("focusin focusout",".text_field",function(_this){return function(e){return $(e.currentTarget).toggleClass("open",e.type==="focusin")}}(this))};AppearanceEditor.prototype.setup_image_picker=function(){var el,image_pickers;image_pickers=this.el.find(".image_picker");return this.image_pickers=function(){var i,len,results;results=[];for(i=0,len=image_pickers.length;i<len;i++){el=image_pickers[i];results.push(new ImagePicker($(el),this,function(_this){return function(){return _this.update_image.apply(_this,arguments)}}(this)))}return results}.call(this)};AppearanceEditor.prototype.setup_color_picker=function(){var i,len,picker,pickers;this.el.dispatch("click",{color_preview:function(_this){return function(btn){return _this.open_color_picker(btn.closest(".color_picker"))}}(this)});this.el.on("click",".color_picker .close_btn",function(_this){return function(e){var picker;picker=$(e.target).closest(".color_picker");return picker.data("close")()}}(this));this.el.find("input[type='text']").on("focus",function(_this){return function(e){return _this.open_color_picker($(e.target).closest(".color_picker"),false)}}(this));pickers=this.el.find(".color_picker");for(i=0,len=pickers.length;i<len;i++){picker=pickers[i];picker=$(picker);this.set_picker_color(picker,this.style[picker.find("[data-name]").data("name")])}pickers.on("keyup","input",function(_this){return function(e){var color,ref;color=$(e.currentTarget).val();return(ref=$(e.delegateTarget).data("farb"))!=null?ref.setColor(color):void 0}}(this));return pickers.on("change","input",function(_this){return function(e){var color,ref;picker=$(e.delegateTarget);if(color=(ref=picker.data("farb"))!=null?ref.color:void 0){return picker.find("input").val(color)}}}(this))};AppearanceEditor.prototype.set_picker_color=function(picker,color){var farb,h,input,l,preview,ref,s;farb=picker.data("farb")||new $._farbtastic($());input=picker.find("input");if(color){input.val(color)}else{color=input.val()}preview=picker.find(".color_preview");input=picker.find("input");ref=farb.RGBToHSL(farb.unpack(color)),h=ref[0],s=ref[1],l=ref[2];preview.toggleClass("is_bright",l>.9);preview.css("backgroundColor",color);return this.update_color(picker.find("[data-name]").data("name"),color)};AppearanceEditor.prototype.open_color_picker=function(picker,toggle){var base,farb,i,input,len,other_picker,popup,preview,ref;if(toggle==null){toggle=true}if(picker.is(".flyout_open")){if(toggle){picker.data("close")()}return false}ref=this.el.find(".color_picker");for(i=0,len=ref.length;i<len;i++){other_picker=ref[i];if(typeof(base=$(other_picker).data("close"))==="function"){base()}}popup=$('<div class="color_popup input_flyout">\n  <div class="close_btn">&times;</div>\n  <div class="farb"></div>\n</div>');input=picker.find("input");preview=picker.find(".color_preview");picker.data("close",function(_this){return function(){popup.removeClass("open");picker.removeClass("flyout_open").removeData("farb");$(document.body).off("click.color_picker");$(window).off("keydown.color_picker");return setTimeout(function(){return popup.remove()},200)}}(this));farb=$.farbtastic(popup.find(".farb"),function(_this){return function(color){return _this.set_picker_color(picker,color)}}(this));picker.data("farb",farb);farb.setColor(input.val());$(document.body).on("click.color_picker",function(_this){return function(e){if($(e.target).closest(".color_picker").length){return}return picker.data("close")()}}(this));$(window).on("keydown.color_picker",function(_this){return function(e){if(e.keyCode===27){return picker.data("close")()}}}(this));picker.append(popup).addClass("flyout_open");return _.defer(function(_this){return function(){return popup.addClass("open")}}(this))};return AppearanceEditor}()}).call(this);(function(){var slice=[].slice;I.theme_template_scope={first:function(a,b,c,d){var ref,ref1;return(ref=(ref1=a!=null?a:b)!=null?ref1:c)!=null?ref:slice.call(arguments).find(function(_this){return function(v){return v!=null}}(this))},when:function(_this){return function(val,expected,ret,other){if(val===expected){return ret}else{return other}}}(this),sub_color2:I.Color.sub_color2,sub_color:I.Color.sub_color,mix_color:I.Color.mix_color,alpha:function(color,a){var b,g,r,ref;ref=I.Color.parse_color_safe(color),r=ref[0],g=ref[1],b=ref[2];return"rgba("+r+", "+g+", "+b+", "+a+")"},bg_color_for_input:function(color){var bg_sub,l,p,ref;bg_sub=I.Color.sub_color2(color,.1);l=(ref=I.Color).luma.apply(ref,I.Color.parse_color_safe(color));p=Math.min(1,Math.max(0,(l-.5)*2));return I.Color.mix_color("#ffffff",bg_sub,p)},text_color_for_bg:function(color){return I.Color.readable_text_color(color)},text_shadow_color_for_bg:function(color){var ref,y;y=(ref=I.Color).relative_luma.apply(ref,I.Color.parse_color_safe(color));if(y>=.45){return"transparent"}else{return I.Color.sub_color2(color)}}}}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("ThemeEditor");types=PropTypes;P("CSSInstructionsLightbox",{render:function(){return R.Lightbox({className:"css_instructions_lightbox_widget"},h2({},"Custom CSS"),p({},"Keep in mind we sometimes upgrade itch.io's pages and it's difficult to ensure those changes don't conflict with custom layouts people have done with the CSS editor. ",strong({},"Enhancing existing components instead of trying to redo the entire page is the best way to avoid any problems. ")),p({},"Please read the ",a({href:this.props.css_guide_url,target:"_blank"},"Custom CSS guide")," before using any custom CSS."),p({},"If there's a customization you think that we should include as part of the theme editor then ",a({href:"/support",target:"_blank"},"send us a message"),"."),p({},button({type:"button",className:"button",onClick:function(_this){return function(){return I.Lightbox.close()}}(this)},"Got it")))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("ThemeEditor");types=PropTypes;P("ErrorLightbox",{propTypes:{title:types.string,errors:types.array.isRequired},render:function(){return R.Lightbox.apply(R,[{className:"game_edit_error_lightbox_widget compact"},h2({},this.props.title||"We encountered an error")].concat(slice.call(this.props.errors.map(function(_this){return function(e){return p({},e)}}(this))),[p({className:"sub_text"},this.props.sub_text)],[p({className:"buttons"},button({className:"button",type:"button",onClick:function(_this){return function(){return I.Lightbox.close()}}(this)},"Close"))]))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,stop_propagation,strong,textarea,types,ul,hasProp={}.hasOwnProperty,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("ThemeEditor");types=PropTypes;stop_propagation=function(_this){return function(e){return e.stopPropagation()}}(this);P("FontPickerFontRow",{pure:true,render:function(){var font;font=this.props.font;return li({},button({onClick:this.props.select_font,type:"button","data-family":font.family},span({},span({className:"family_name"},font.family),br({}),span({className:"category"},font.category)),a({href:"https://fonts.google.com/specimen/"+font.family,target:"_blank",onClick:stop_propagation},"preview")))}});P("FontPickerLightbox",{getInitialState:function(_this){return function(){return{loading_fonts:true,filter_category:"all"}}}(this),render:function(){var key;return R.Lightbox({className:"font_picker_lightbox_widget compact"},h2({},"Select a font"),div({className:"form"},div({className:"font_filter"},input({type:"text",value:this.state.filter||"",onChange:function(_this){return function(e){var filter;filter=e.currentTarget.value;if($.trim(filter)===""){filter=null}_this.reset_scroll();return _this.setState({filter:filter})}}(this),placeholder:"Search for font by name..."}),R.Forms.SimpleSelect({value:this.state.filter_category,onChange:function(_this){return function(value){_this.reset_scroll();return _this.setState({filter_category:value})}}(this),options:[{name:"All fonts",value:"all"}].concat(slice.call(function(){var ref,results;ref=this.state.font_categories||[];results=[];for(key in ref){if(!hasProp.call(ref,key))continue;results.push({name:key,value:key})}return results}.call(this)))})),this.render_font_list(),p({className:"google_fonts"},"These fonts are pulled from Google Fonts, consider ",a({href:"https://fonts.google.com/",target:"_blank"},"using their directory")," and typing the font name here.")))},reset_scroll:function(){if(this.refs.scroller){return this.refs.scroller.scrollTop=0}},select_font:function(e){var base,target;target=e.currentTarget;if($(target).is("[href]")){return}return typeof(base=this.props).on_pick_font==="function"?base.on_pick_font(target.dataset.family):void 0},render_font_list:function(){var available_fonts,filter_font,r;if(this.state.loading_fonts){return p({className:"loading"},"Loading list...")}r=this.state.filter?new RegExp("\\b"+I.escape_regex($.trim(this.state.filter)),"i"):void 0;filter_font=function(_this){return function(font){if(_this.state.filter_category!=="all"){if(font.category!==_this.state.filter_category){return false}}if(_this.state.filter){if(font.family===_this.state.filter){return true}return r.test(font.family)}else{return true}}}(this);available_fonts=this.state.fonts.filter(filter_font).map(function(_this){return function(font){return P.FontPickerFontRow({key:font.family,select_font:_this.select_font,font:font})}}(this));return ul({className:"font_list",ref:"scroller"},available_fonts.length?available_fonts:li({className:"empty_search"},"No results found"))},componentDidMount:function(){var fetch_fonts;fetch_fonts=this.props.fonts?$.when(this.props.fonts):$.getJSON(this.props.fonts_url);return fetch_fonts.then(function(_this){return function(fonts){var font,font_categories,i,len;font_categories={};for(i=0,len=fonts.length;i<len;i++){font=fonts[i];if(!font_categories[font.category]){font_categories[font.category]=0}font_categories[font.category]+=1}return _this.setState({loading_fonts:false,font_categories:font_categories,fonts:fonts})}}(this))}})})}).call(this);(function(){I.libs.react.done(function(){var CSSTransition,P,TransitionGroup,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("GameEdit");types=PropTypes;TransitionGroup=ReactTransitionGroup.TransitionGroup,CSSTransition=ReactTransitionGroup.CSSTransition;P("ThemeEditor",{getInitialState:function(){return $.extend({open:this.props.open||false,fonts:this.props.fonts,css_template:this.props.css_template?window["eval"](this.props.css_template):void 0},this.props.theme)},render_to_css:function(){var align,alpha,background_layers,color1,color2,embed_background_css,font,header_font,ref,ref1,rgba,theme,wrapper_background_css;if(!this.state.css_template){console.warn("tried to render to css but we don't have a template");return}wrapper_background_css=this.state.background_image?(align=function(){switch(this.state.background_position){case"align_left":return"0 0 ";case"align_right":return"100% 0";default:return"50% 0"}}.call(this),_.compact(["background-image: url('"+this.state.background_image.thumb_url+"')","background-repeat: "+(this.state.background_repeat||"repeat"),"background-position: "+align,this.state.background_attach==="fixed"?"background-attachment: fixed":void 0]).join(";")):"";embed_background_css=this.state.embed_background_image?(background_layers=["url('"+this.state.embed_background_image.thumb_url+"')"],(color1=this.state.embed_background_color1)?(color2=(ref=this.state.embed_background_color2)!=null?ref:color1,alpha=((ref1=this.state.embed_background_alpha)!=null?ref1:50)/100,rgba=I.theme_template_scope.alpha,background_layers.unshift("linear-gradient(to bottom, "+rgba(color1,alpha)+", "+rgba(color2,alpha)+")")):void 0,_.compact(["background-image: "+background_layers.join(",")+";"])):"";font=this.state.fonts.find(function(_this){return function(f){return f.slug===_this.state.font_family}}(this));header_font=this.state.fonts.find(function(_this){return function(f){return f.slug===_this.state.header_font_family}}(this));theme=$.extend(Object.create(I.theme_template_scope),{wrapper_background_css:wrapper_background_css,embed_background_css:embed_background_css,font_family:R.ThemeEditor.escape_font_family((font!=null?font.family:void 0)||"inherit"),header_font_family:R.ThemeEditor.escape_font_family((header_font!=null?header_font.family:void 0)||"inherit"),header_text_color:this.state.header_text_color||"inherit"},_.pick.apply(_,[this.state].concat(slice.call(["bg_color","bg2_color","text_color","link_color","button_color","header_text_color","screenshots_loc","default_screenshots_loc","bg2_alpha"]))));theme=new Proxy(theme,{has:function(_this){return function(){return true}}(this)});return this.state.css_template(theme)},render_banner:function(){var banner,position;this._header||(this._header=$("#header"));this._header.removeClass().addClass("header");banner=this.state.banner_image;if(banner){position=this.state.banner_position||"align_center";img=this._header.find("img");this._header.addClass("has_image").addClass(position);if(img.exists()){return img.attr("src",banner.thumb_url)}else{return $("<img src='"+banner.thumb_url+"'/>").appendTo(this._header)}}},load_font:function(family){var font;this.loaded_fonts||(this.loaded_fonts=$.extend({},this.props.loaded_fonts));if(this.loaded_fonts[family]){return}this.loaded_fonts[family]=true;font=this.state.fonts.find(function(f){return f.slug===family});if(!font){return}if(font.href&&!$("link[data-font='"+font.slug+"']").exists()){return $("<link rel='stylesheet' href='"+font.href+"' data-font='"+font.slug+"'></link>").appendTo("head")}},apply_css:function(){var classes;this.style_el||(this.style_el=$("#game_theme").exists()||$("<style type='text/css' id='game_theme'></style>").appendTo($("head")));this.style_el[0].innerHTML=I.strip_css(this.render_to_css()||"");if(this.props.can_use_css){this.custom_style_el||(this.custom_style_el=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head")));this.custom_style_el[0].innerHTML=I.strip_css(this.state.css||"")}this.render_banner();this.load_font(this.state.font_family);this.load_font(this.state.header_font_family);classes=classNames(["inner_column",this.state.font_family?"family_"+this.state.font_family:void 0,this.state.font_size?"size_"+this.state.font_size:void 0]);return $("#inner_column").removeClass().addClass(classes)},componentDidUpdate:function(prev_props,prev_state){this.apply_css_throttled||(this.apply_css_throttled=_.throttle(this.apply_css,100));return this.apply_css_throttled()},save:function(){this.setState({loading:true});return I.remote_submit($(this.refs.form)).then(function(_this){return function(res){_this.setState({loading:false});if(res.errors){return I.Lightbox.open(R.ThemeEditor.ErrorLightbox({errors:res.errors,sub_text:"Your changes were not saved, please try again"}))}}}(this))},render:function(){return React.createElement(TransitionGroup,{key:"transition_group",component:"span"},this.state.open?React.createElement(CSSTransition,{classNames:"slide_in",timeout:{enter:200,exit:1}},this.render_sidebar()):void 0)},render_sidebar:function(){return this.enclose({className:"theme_editor_widget",key:"real"},form({ref:"form",method:"POST",action:this.props.submit_url,onSubmit:function(_this){return function(e){e.preventDefault();return _this.save()}}(this)},R.CSRF({}),section.apply(null,[{className:"input_group"}].concat(slice.call(this.render_color_pickers()))),section.apply(null,[{className:"input_group"}].concat(slice.call(this.render_font_pickers()))),section.apply(null,[{className:"input_group"}].concat(slice.call(this.render_layout_options()))),this.render_image_uploaders(),this.render_css_editor(),div({className:"buttons save_buttons"},button({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading||false},this.state.loading&&"Saving..."||"Save"))))},append_font:function(font){return this.setState({fonts:slice.call(this.state.fonts).concat([font])})},render_font_pickers:function(){var ref;return[h3({},"Text"),label({className:"horiz_input"},span({className:"label_text"},"Font"),R.ThemeEditor.FontSelect({name:"layout[font_family]",value:this.state.font_family,fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font,on_pick_family:this.set_font_family||(this.set_font_family=function(_this){return function(family){return _this.setState({font_family:family})}}(this))})),label({className:"horiz_input"},span({className:"label_text"},"Size"),R.Forms.SimpleSelect({name:"layout[font_size]",value:this.state.font_size,onChange:this.set_font_size||(this.set_font_size=function(_this){return function(size){return _this.setState({font_size:size})}}(this)),options:this.font_size_options||(this.font_size_options=[{name:"Small",value:"small"},{name:"Medium",value:"medium"},{name:"Large",value:"large"},{name:"Very Large",value:"very_large"}])})),R.ThemeEditor.MoreGroup({label:"More options...",ref:"more_font_options",default_open:!!((ref=this.props.theme)!=null?ref.header_font_family:void 0)},label({className:"horiz_input"},span({className:"label_text"},"Header font"),R.ThemeEditor.FontSelect({name:"layout[header_font_family]",allow_default:true,value:this.state.header_font_family,fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font,on_pick_family:this.set_header_font_family||(this.set_header_font_family=function(_this){return function(family){return _this.setState({header_font_family:family})}}(this))})))]},render_align_select:function(name,state_field){var name1;return label({className:"horiz_input"},span({className:"label_text"},"Align"),R.Forms.SimpleSelect({name:name,value:this.state[state_field],onChange:this[name1="set_"+state_field]||(this[name1]=function(_this){return function(val){var o;o={};o[state_field]=val;return _this.setState(o)}}(this)),options:this.image_align_options||(this.image_align_options=[{name:"Center",value:"align_center"},{name:"Left",value:"align_left"},{name:"Right",value:"align_right"}])}))},render_image_uploaders:function(){var ref;return section({className:"input_group"},h3({},"Images"),R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,upload:this.state.banner_image,name:"layout[banner_image][image_id]",label:"Banner",upload_label:"Upload",on_upload:this.set_banner_image||(this.set_banner_image=function(_this){return function(upload){return _this.setState({banner_image:upload})}}(this))},this.state.banner_image?div({className:"position_fields"},this.render_align_select("layout[banner_image][position]","banner_position")):void 0),R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,upload:this.state.background_image,name:"layout[background_image][image_id]",label:"Background",upload_label:"Upload",on_upload:this.set_background_image||(this.set_background_image=function(_this){return function(upload){return _this.setState({background_image:upload})}}(this))},this.state.background_image?div({className:"position_fields"},label({className:"horiz_input"},span({className:"label_text"},"Repeat"),R.Forms.SimpleSelect({name:"layout[background_image][repeat]",value:this.state.background_repeat,onChange:this.set_background_repeat||(this.set_background_repeat=function(_this){return function(val){return _this.setState({background_repeat:val})}}(this)),options:this.background_repeat_options||(this.background_repeat_options=[{name:"Both",value:"repeat"},{name:"Horizontally",value:"repeat-x"},{name:"Vertically",value:"repeat-y"},{name:"None",value:"no-repeat"}])})),this.render_align_select("layout[background_image][position]","background_position"),label({className:"horiz_input"},span({className:"label_text"},"Fixed"),div({},input({type:"checkbox",name:"layout[background_image][attach]",value:"fixed",checked:this.state.background_attach==="fixed",onChange:this.set_background_attach||(this.set_background_attach=function(_this){return function(e){return _this.setState({background_attach:e.target.checked?"fixed":null})}}(this))})))):void 0),this.props.game_type==="html"||this.state.embed_background_image?R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,name:"layout[embed_background_image][image_id]",label:"Embed BG",upload_label:"Upload",upload:this.state.embed_background_image,on_upload:function(_this){return function(upload){return _this.setState({embed_background_image:upload})}}(this)},div({className:"color_options"},label({className:"horiz_input"},span({className:"label_text"},"Color 1"),this.color_input("embed_background_color1",{name:"layout[embed_background_image][color1]"})),label({className:"horiz_input"},span({className:"label_text"},"Color 2"),this.color_input("embed_background_color2",{name:"layout[embed_background_image][color2]",allow_empty:true})),label({className:"horiz_input"},span({className:"label_text"},"Alpha"),R.Forms.Slider({min:0,max:100,show_tooltip:true,value:(ref=this.state.embed_background_alpha)!=null?ref:50,name:"layout[embed_background_image][alpha]",onChange:this.set_embed_background_alpha||(this.set_embed_background_alpha=function(_this){return function(val){return _this.setState({embed_background_alpha:val})}}(this))})))):void 0)},color_input:function(field_name,opts){var name1,ref;if(opts==null){opts={}}return R.Forms.ColorInput({name:(ref=opts.name)!=null?ref:"layout["+field_name+"]",popout_portal_target:document.body,className:"compact",value:this.state[field_name],allow_empty:opts.allow_empty,onChange:this[name1="set_"+field_name]||(this[name1]=function(_this){return function(color){var update;if(color===""){color=void 0}update={};update[field_name]=color;return _this.setState(update)}}(this))})},render_color_pickers:function(){var ref,ref1,ref2,ref3;return[h3({},"Color"),label({className:"horiz_input"},span({className:"label_text"},"BG"),this.color_input("bg_color")),label({className:"horiz_input"},span({className:"label_text"},"BG 2"),this.color_input("bg2_color")),label({className:"horiz_input"},span({className:"label_text"},"Text"),this.color_input("text_color")),label({className:"horiz_input"},span({className:"label_text"},"Link"),this.color_input("link_color")),R.ThemeEditor.MoreGroup({label:"More options...",ref:"more_color_options",default_open:((ref=this.props.theme)!=null?ref.header_text_color:void 0)||((ref1=this.props.theme)!=null?ref1.button_color:void 0)||((ref2=this.props.theme)!=null?ref2.bg2_alpha:void 0)!=null},label({className:"horiz_input"},span({className:"label_text"},"Headers"),this.color_input("header_text_color",{allow_empty:true})),label({className:"horiz_input"},span({className:"label_text"},"Buttons"),this.color_input("button_color",{allow_empty:true})),label({className:"horiz_input"},span({className:"label_text"},"BG2 Alpha"),R.Forms.Slider({min:0,max:100,show_tooltip:true,value:(ref3=this.state.bg2_alpha)!=null?ref3:100,name:"layout[bg2_alpha]",onChange:this.set_bg2_alpha||(this.set_bg2_alpha=function(_this){return function(val){return _this.setState({bg2_alpha:val})}}(this))})))]},render_css_editor:function(){if(!this.props.can_use_css){return}return section({className:"input_group css_editor"},h3({},"Misc"),R.ThemeEditor.CssEditor({name:"layout[css]",value:this.state.css,css_guide_url:this.props.css_guide_url,on_change:this.set_css||(this.set_css=function(_this){return function(e){return _this.setState({css:e.target.value})}}(this))}))},render_layout_options:function(){return[h3({},"Layout"),label({className:"horiz_input"},span({className:"label_text"},"Screenshots"),R.Forms.SimpleSelect({name:"layout[screenshots_loc]",value:this.state.screenshots_loc||"",onChange:this.setup_screenshots_loc||(this.setup_screenshots_loc=function(_this){return function(val){if(!val){val=void 0}return _this.setState({screenshots_loc:val})}}(this)),options:this.screenshots_loc_options||(this.screenshots_loc_options=[{name:"Auto ("+this.state.default_screenshots_loc+")",short_name:"Auto",value:""},{name:"Sidebar",value:"sidebar"},{name:"Hidden",value:"hidden"}])}))]}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("ThemeEditor");types=PropTypes;R.Icons||(R.Icons={});R.Icons.Grab=function(props){var height,ref,ref1,width;if(props==null){props={}}width=(ref=props.width)!=null?ref:18;height=(ref1=props.height)!=null?ref1:16;return React.createElement("svg",{className:"svgicon icon_grab",fill:"currentColor",stroke:"none",role:"img",version:"1.1",viewBox:"0 0 18 16",width:width,height:height,"aria-hidden":true},React.createElement("rect",{width:"18",height:"4"}),React.createElement("rect",{y:"12",width:"18",height:"4"}),React.createElement("rect",{y:"6",width:"18",height:"4"}))};P("OrderPickerItem",{pure:true,propTypes:{item:types.shape({id:types.number,order:types.number,name:types.string,hidden:types.bool,type:types.string},{position:types.number,input_name:types.string})},input_name:function(name){return this.props.input_name+"["+(this.props.position+1)+"]["+name+"]"},render:function(){var item;item=this.props.item;return div({"data-id":item.id,className:classNames("order_row",{dragging:this.props.dragging})},this.props.input_name?input({type:"hidden",className:"position_input",name:this.input_name("id"),value:item.id}):void 0,this.props.item.hidden&&this.props.input_name?input({type:"hidden",name:this.input_name("hidden"),value:"1"}):void 0,R.Icons.Grab({}),span({className:"item_name",title:item.name},item.name),button({type:"button",className:classNames("hide_btn",{is_active:this.props.item.hidden}),onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("order_picker_item:hidden",_this.props.item,!_this.props.item.hidden)}}(this)},this.props.item.hidden?"Hidden":"Hide"))}});P("OrderPicker",{pure:true,propTypes:{input_name:types.string,update_order:types.func,items:types.arrayOf(types.shape({id:types.number,name:types.string,hidden:types.bool,type:types.string}))},getInitialState:function(){return{items:this.props.items}},update_order:function(ids){var base,item,items,items_by_id,j,len,ref;items_by_id={};ref=this.state.items;for(j=0,len=ref.length;j<len;j++){item=ref[j];items_by_id[""+item.id]=item}items=ids.map(function(_this){return function(id){return items_by_id[id]}}(this));this.setState({items:items});return typeof(base=this.props).update_order==="function"?base.update_order(items):void 0},componentDidMount:function(){var el;el=$(this.list_ref.current);this.dispatch("order_picker_item",{hidden:function(_this){return function(e,item,hidden){var base,items;items=_this.state.items.map(function(list_item){if(item.id===list_item.id){return $.extend({},item,{hidden:hidden})}else{return list_item}});_this.setState({items:items});return typeof(base=_this.props).update_order==="function"?base.update_order(items):void 0}}(this)});return window.requestAnimationFrame(function(_this){return function(){return el.sortable({cancel:"button"}).on("sortstop",function(e){var order;order=el.sortable("toArray",{attribute:"data-id"});el.sortable("cancel");return _this.update_order(order)})}}(this))},render:function(){return this.enclose({ref:this.list_ref||(this.list_ref=React.createRef()),className:"sorting_picker"},this.state.items.map(function(_this){return function(item,i){return R.ThemeEditor.OrderPickerItem({key:item.id,position:i,item:item,input_name:_this.props.input_name})}}(this)))}})})}).call(this);(function(){I.libs.react.done(function(){var CSSTransition,P,TransitionGroup,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("Profile");types=PropTypes;TransitionGroup=ReactTransitionGroup.TransitionGroup,CSSTransition=ReactTransitionGroup.CSSTransition;P("ThemeEditor",{getInitialState:function(){return{open:false,fonts:this.props.fonts,css_template:this.props.css_template?window["eval"](this.props.css_template):void 0,theme:this.props.theme,banner_image:this.props.banner_image,background_image:this.props.background_image}},update_theme:function(key,value){var update;if(this.state.theme[key]===value){return}update={};update[key]=value;return this.setState({theme:Object.assign({},this.state.theme,update)})},componentDidUpdate:function(prev_props,prev_state){this.apply_css_throttled||(this.apply_css_throttled=_.throttle(this.apply_css,100));this.apply_css_throttled();if(prev_state.theme.game_order!==this.state.theme.game_order||prev_state.theme.hidden_games!==this.state.theme.hidden_games){this.apply_project_order()}if(prev_state.theme.collection_order!==this.state.theme.collection_order||prev_state.theme.hidden_collections!==this.state.theme.hidden_collections){return this.apply_collection_order()}},render_to_css:function(){var background_image_css,font,ref,ref1,theme;if(!this.state.css_template){console.warn("tried to render to css but we don't have a template");return}font=this.state.fonts.find(function(_this){return function(f){return f.slug===_this.state.theme.font_family}}(this));background_image_css=R.ThemeEditor.background_css(this.state.background_image,this.state.theme.background_image);theme=Object.assign(Object.create(I.theme_template_scope),{font_size:((ref=this.state.theme.font_size)!=null?ref:100)+"%",font_family:R.ThemeEditor.escape_font_family((font!=null?font.family:void 0)||"inherit"),background_image_css:background_image_css,border_radius:this.state.theme.border_radius?this.state.theme.border_radius+"px":void 0,header_image_css:((ref1=this.state.theme.banner_image)!=null?ref1.size:void 0)==="full"?"width: 100%;":void 0},_.pick.apply(_,[this.state.theme].concat(slice.call(["bg_color","text_color","link_color"]))));theme=new Proxy(theme,{has:function(_this){return function(){return true}}(this)});return this.state.css_template(theme)},apply_css:function(){var has_banner,ref;this.style_el||(this.style_el=$("#user_theme").exists()||$("<style type='text/css' id='user_theme'></style>").appendTo($("head")));this.style_el[0].innerHTML=I.strip_css(this.render_to_css()||"");this._user_page||(this._user_page=$(".user_page.page_widget"));has_banner=!!((ref=this.state.theme.banner_image)!=null?ref.id:void 0);this._user_page.toggleClass("has_banner",has_banner);this._user_page.toggleClass("mode_grid",this.state.theme.layout==="grid");this._user_page.toggleClass("mode_column",this.state.theme.layout==="column");this._user_page.toggleClass("mode_collection_grid",this.state.theme.collection_layout==="grid");this._user_page.toggleClass("mode_show_purchases",!!this.state.theme.show_purchases);if(has_banner){this._user_header_image||(this._user_header_image=$("#profile_header .profile_banner"));if(this.state.banner_image){this._user_header_image.attr("src",this.state.banner_image.thumb_url)}}if(this.props.can_use_css){this.custom_style_el||(this.custom_style_el=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head")));this.custom_style_el[0].innerHTML=I.strip_css(this.state.theme.css||"")}return this.load_font(this.state.theme.font_family)},apply_project_order:function(){var cell,cells_by_id,current_order,el,game_grid,game_id,game_order,hidden,i,id,len,results;game_grid=this._user_page.find(".user_game_grid");cells_by_id={};current_order=function(){var i,len,ref,results;ref=game_grid.children(".game_cell");results=[];for(i=0,len=ref.length;i<len;i++){cell=ref[i];game_id=parseInt($(cell).data("game_id"));cells_by_id[game_id]=cell;results.push(game_id)}return results}();game_order=this.state.theme.game_order||current_order;hidden=this.state.theme.hidden_games||[];results=[];for(i=0,len=game_order.length;i<len;i++){id=game_order[i];el=cells_by_id[id];if(!el){continue}el.style.display=indexOf.call(hidden,id)>=0?"none":"";results.push(game_grid.append(el))}return results},apply_collection_order:function(){var collection_id,collection_order,collections,current_order,el,hidden,i,id,len,results,row,rows_by_id;collections=this._user_page.find(".collections");rows_by_id={};current_order=function(){var i,len,ref,results;ref=collections.children(".collection_row");results=[];for(i=0,len=ref.length;i<len;i++){row=ref[i];collection_id=parseInt($(row).data("collection_id"));rows_by_id[collection_id]=row;results.push(collection_id)}return results}();collection_order=this.state.theme.collection_order||current_order;hidden=this.state.theme.hidden_collections||[];results=[];for(i=0,len=collection_order.length;i<len;i++){id=collection_order[i];el=rows_by_id[id];if(!el){continue}el.style.display=indexOf.call(hidden,id)>=0?"none":"";results.push(collections.append(el))}return results},load_font:function(family){var font;this.loaded_fonts||(this.loaded_fonts=$.extend({},this.props.loaded_fonts));if(this.loaded_fonts[family]){return}this.loaded_fonts[family]=true;font=this.state.fonts.find(function(f){return f.slug===family});if(!font){return}if(font.href&&!$("link[data-font='"+font.slug+"']").exists()){return $("<link rel='stylesheet' href='"+font.href+"' data-font='"+font.slug+"'></link>").appendTo("head")}},render:function(){return React.createElement(TransitionGroup,{key:"transition_group",component:"span"},this.state.open?React.createElement(CSSTransition,{classNames:"slide_in",timeout:{enter:200,exit:1}},this.render_sidebar()):void 0)},render_sidebar:function(){return this.enclose({key:"real",className:"theme_editor_widget"},p({},"You can edit your profile's content on your ",a({href:this.props.user_settings_url,target:"_blank"},"account profile settings"),"."),form({ref:this.form_ref||(this.form_ref=React.createRef()),method:"POST",onSubmit:function(_this){return function(e){var theme;e.preventDefault();theme=JSON.stringify(_this.state.theme);_this.setState({loading:true});return $.ajax({url:_this.props.submit_url,type:"POST",data:I.with_csrf({theme:theme}),xhrFields:{withCredentials:true},error:function(xhr){_this.setState({loading:false});return I.Lightbox.open(R.ThemeEditor.ErrorLightbox({errors:["Server error"],sub_text:"Your changes were not saved, please try again"}))},success:function(res){_this.setState({loading:false});if(res.errors){return I.Lightbox.open(R.ThemeEditor.ErrorLightbox({errors:res.errors,sub_text:"Your changes were not saved, please try again"}))}}})}}(this)},this.render_color_pickers(),this.render_text_settings(),this.render_images(),this.render_project_settings(),this.render_collection_order(),this.render_css_editor(),div({className:"buttons save_buttons"},button({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading||false},this.state.loading&&"Saving..."||"Save"))))},color_input:function(field_name,opts){var name;if(opts==null){opts={}}return R.Forms.ColorInput({popout_portal_target:document.body,className:"compact",value:this.state.theme[field_name],allow_empty:opts.allow_empty,onChange:this[name="set_"+field_name]||(this[name]=function(_this){return function(color){if(color===""){color=void 0}return _this.update_theme(field_name,color)}}(this))})},render_css_editor:function(){if(!this.props.can_use_css){return}return section({className:"input_group css_editor"},h3({},"Misc"),R.ThemeEditor.CssEditor({value:this.state.theme.css||"",css_guide_url:this.props.css_guide_url,on_change:this.set_css||(this.set_css=function(_this){return function(e){return _this.update_theme("css",e.target.value)}}(this))}))},render_color_pickers:function(){return section({className:"input_group"},h3({},"Color"),label({className:"horiz_input"},span({className:"label_text"},"BG"),this.color_input("bg_color")),label({className:"horiz_input"},span({className:"label_text"},"Text"),this.color_input("text_color")),label({className:"horiz_input"},span({className:"label_text"},"Link"),this.color_input("link_color")))},render_text_settings:function(){var ref;return section({className:"input_group"},h3({},"Text"),label({className:"horiz_input"},span({className:"label_text"},"Font"),R.ThemeEditor.FontSelect({fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font||(this.append_font=function(_this){return function(font){return _this.setState({fonts:slice.call(_this.state.fonts).concat([font])})}}(this)),value:this.state.theme.font_family||"",on_pick_family:this.set_font_family||(this.set_font_family=function(_this){return function(family){return _this.update_theme("font_family",family)}}(this))})),label({className:"horiz_input"},span({className:"label_text"},"Size"),R.Forms.Slider({min:75,max:175,show_tooltip:true,value:(ref=this.state.theme.font_size)!=null?ref:100,onChange:this.set_font_size||(this.set_font_size=function(_this){return function(val){return _this.update_theme("font_size",val)}}(this))})))},render_images:function(){var ref;return section({className:"input_group"},h3({},"Images"),R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,upload:this.state.banner_image,label:"Banner",upload_label:"Upload",on_upload:this.set_banner_image||(this.set_banner_image=function(_this){return function(upload){_this.setState({banner_image:upload});return _this.update_theme("banner_image",Object.assign({},_this.state.theme.banner_image||{size:"fixed"},{id:upload!=null?upload.id:void 0}))}}(this))},this.state.banner_image?div({className:"position_fields"},label({className:"horiz_input"},span({className:"label_text"},"Size"),R.Forms.SimpleSelect({value:((ref=this.state.theme.banner_image)!=null?ref.size:void 0)||"",onChange:this.set_banner_image_size||(this.set_banner_image_size=function(_this){return function(val){return _this.update_theme("banner_image",Object.assign({},_this.state.theme.banner_image||{},{size:val}))}}(this)),options:this.banner_image_size_options||(this.banner_image_size_options=[{name:"Fixed width ",value:"fixed"},{name:"Full width",value:"full"}])}))):void 0),R.ThemeEditor.BackgroundImageUploader({image_upload_url:this.props.image_upload_url,upload:this.state.background_image,params:this.state.theme.background_image,on_change:function(_this){return function(upload,params){_this.update_theme("background_image",params);return _this.setState({background_image:upload})}}(this)}))},render_project_settings:function(){var ref;if(!(this.props.games&&this.props.games.length)){return}return section({className:"input_group project_input_group"},h3({},"My Projects"),label({className:"horiz_input"},span({className:"label_text"},"Layout"),R.Forms.SimpleSelect({value:this.state.theme.layout||"",onChange:this.set_layout||(this.set_layout=function(_this){return function(v){return _this.update_theme("layout",v)}}(this)),options:this.layout_options||(this.layout_options=[{name:"Sidebar",value:"column"},{name:"Grid",value:"grid"}])})),label({className:"horiz_input"},span({className:"label_text"},"B. Radius"),R.Forms.Slider({min:0,max:150,show_tooltip:true,value:(ref=this.state.theme.border_radius)!=null?ref:0,onChange:this.set_border_radius||(this.set_border_radius=function(_this){return function(val){return _this.update_theme("border_radius",val)}}(this))})),R.ThemeEditor.OrderPicker({items:this.props.games,update_order:this.set_game_order||(this.set_game_order=function(_this){return function(items){var item;return _this.setState({theme:Object.assign({},_this.state.theme,{game_order:function(){var i,len,results;results=[];for(i=0,len=items.length;i<len;i++){item=items[i];results.push(item.id)}return results}(),hidden_games:function(){var i,len,results;results=[];for(i=0,len=items.length;i<len;i++){item=items[i];if(item.hidden){results.push(item.id)}}return results}()})})}}(this))}))},render_collection_order:function(){if(!(this.props.collections&&this.props.collections.length)){return}return section({className:"input_group collection_input_group"},h3({},"Collections"),label({className:"horiz_input"},span({className:"label_text"},"Layout"),R.Forms.SimpleSelect({value:this.state.theme.collection_layout||"",onChange:this.set_collection_layout||(this.set_collection_layout=function(_this){return function(v){return _this.update_theme("collection_layout",v)}}(this)),options:this.collection_layout_options||(this.collection_layout_options=[{name:"List",value:"list"},{name:"Grid",value:"grid"}])})),label({className:"horiz_input wide_label"},span({className:"label_text"},"Supported by me"),div({},input({type:"checkbox",checked:this.state.theme.show_purchases||false,onChange:this.set_show_purchases||(this.set_show_purchases=function(_this){return function(e){return _this.update_theme("show_purchases",e.target.checked)}}(this))}))),R.ThemeEditor.OrderPicker({items:this.props.collections,update_order:this.set_collection_order||(this.set_collection_order=function(_this){return function(items){var item;return _this.setState({theme:Object.assign({},_this.state.theme,{collection_order:function(){var i,len,results;results=[];for(i=0,len=items.length;i<len;i++){item=items[i];results.push(item.id)}return results}(),hidden_collections:function(){var i,len,results;results=[];for(i=0,len=items.length;i<len;i++){item=items[i];if(item.hidden){results.push(item.id)}}return results}()})})}}(this))}))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("ThemeEditor");types=PropTypes;P.escape_font_family=function(f){if(f.match(/ /)){return"'"+f+"'"}else{return f}};P.background_css=function(image,params){var align;if(image){align=function(){switch(params.position){case"align_left":return"0 0 ";case"align_right":return"100% 0";default:return"50% 0"}}();return _.compact(["background-image: url('"+image.thumb_url+"')","background-repeat: "+(params.repeat||"repeat"),"background-position: "+align,params.attach==="fixed"?"background-attachment: fixed":void 0]).join(";")}else{return""}};P("MoreGroup",{pure:true,getInitialState:function(){return{open:!!this.props.default_open}},render_toggle:function(){return button({type:"button",className:"toggle_button",onClick:function(_this){return function(){return _this.setState({open:!_this.state.open})}}(this)},this.props.label)},render:function(){return this.enclose({className:classNames("more_group",{open:this.state.open})},fieldset({style:{display:this.state.open?"":"none"}},legend({},this.render_toggle()),div({className:"more_children"},this.props.children)),!this.state.open?this.render_toggle():void 0)}});P("FontSelect",{pure:true,propTypes:{fonts:types.array.isRequired,fonts_url:types.string.isRequired,allow_default:types.bool},open_google_fonts:function(){return I.Lightbox.open(R.ThemeEditor.FontPickerLightbox({fonts_url:this.props.fonts_url,on_pick_font:function(_this){return function(font_family){var base,existing,new_font,ref,ref1,slug;I.Lightbox.close();slug=font_family;existing=_this.props.fonts.find(function(f){return f.slug===slug});if(existing){if(typeof(base=_this.props).on_pick_family==="function"){base.on_pick_family(font_family)}return}new_font={slug:slug,name:font_family,family:font_family,type:"google_font",href:"https://fonts.googleapis.com/css?"+$.param({family:font_family+":400,400italic,700,700italic"})};if((ref=_this.props)!=null){ref.on_add_font(new_font)}return(ref1=_this.props)!=null?ref1.on_pick_family(new_font.family):void 0}}(this)}))},render:function(){var font;return R.Forms.SimpleSelect({name:this.props.name,value:this.props.value,onChange:function(_this){return function(font){if(font==="_select_google_font"){return _this.open_google_fonts()}else{return _this.props.on_pick_family(font)}}}(this),options:_.compact([this.props.allow_default?{name:"Default font",value:"_default"}:void 0,{name:"Select Google Font...",value:"_select_google_font"}].concat(slice.call(function(){var i,len,ref,results;ref=this.props.fonts;results=[];for(i=0,len=ref.length;i<len;i++){font=ref[i];results.push({name:font.name,value:font.slug,group:"Fonts"})}return results}.call(this))))})}});P("CssEditorLightbox",{pure:true,render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},"Edit CSS"),p({},"Changes are automatically applied.",this.props.css_guide_url?fragment({}," ",a({href:this.props.css_guide_url,target:"_blank",onClick:function(_this){return function(e){e.preventDefault();return I.Lightbox.open(R.ThemeEditor.CSSInstructionsLightbox({css_guide_url:_this.props.css_guide_url}))}}(this)},"Info about CSS on itch.io.")):void 0),div({className:"input_wrapper"},textarea({defaultValue:this.props.default_value,onChange:this.props.on_change,placeholder:"Type CSS here"})))}});P("CssEditor",{pure:true,render:function(){return fragment({},div({className:"label_help"},label({},div({className:"label_text"},"Custom CSS")),button({type:"button",className:"maximize_button textlike",title:"Expand",onClick:function(_this){return function(e){return I.Lightbox.open(R.ThemeEditor.CssEditorLightbox({default_value:_this.props.value,on_change:_this.props.on_change,css_guide_url:_this.props.css_guide_url}))}}(this)},""),button({type:"button",className:"button small outline",onClick:function(_this){return function(e){return I.Lightbox.open(R.ThemeEditor.CSSInstructionsLightbox({css_guide_url:_this.props.css_guide_url}))}}(this)},"Readme")),textarea({name:this.props.name,value:this.props.value,onChange:this.props.on_change}))}});P("BackgroundImageUploader",{pure:true,getDefaultProps:function(){return{default_params:{repeat:"repeat",position:"align_center"}}},propTypes:{input_name_prefix:types.string,image_upload_url:types.string.isRequired,upload:types.object,on_change:types.func,params:types.object},update_params:function(update){var base,params;params=Object.assign({},this.props.params||{},update);return typeof(base=this.props).on_change==="function"?base.on_change(this.props.upload,params):void 0},render:function(){var ref,ref1,ref2;return R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,upload:this.props.upload,name:this.props.input_name_prefix?this.props.input_name_prefix+"[image_id]":void 0,label:"Background",upload_label:"Upload",on_upload:this.props.on_change?this.on_upload||(this.on_upload=function(_this){return function(upload){var base,params;params=Object.assign({},_this.props.params||_this.props.default_params,{id:upload!=null?upload.id:void 0});return typeof(base=_this.props).on_change==="function"?base.on_change(upload,params):void 0}}(this)):void 0},this.props.upload?div({className:"position_fields"},label({className:"horiz_input"},span({className:"label_text"},"Repeat"),R.Forms.SimpleSelect({name:this.props.input_name_prefix?this.props.input_name_prefix+"[repeat]":void 0,value:(ref=this.props.params)!=null?ref.repeat:void 0,onChange:this.props.on_change?this.set_repeat||(this.set_repeat=function(_this){return function(repeat){return _this.update_params({repeat:repeat})}}(this)):void 0,options:this.background_repeat_options||(this.background_repeat_options=[{name:"Both",value:"repeat"},{name:"Horizontally",value:"repeat-x"},{name:"Vertically",value:"repeat-y"},{name:"None",value:"no-repeat"}])})),label({className:"horiz_input"},span({className:"label_text"},"Align"),R.Forms.SimpleSelect({name:this.props.input_name_prefix?this.props.input_name_prefix+"[position]":void 0,value:(ref1=this.props.params)!=null?ref1.position:void 0,onChange:this.props.on_change?this.set_position||(this.set_position=function(_this){return function(position){return _this.update_params({position:position})}}(this)):void 0,options:this.image_align_options||(this.image_align_options=[{name:"Center",value:"align_center"},{name:"Left",value:"align_left"},{name:"Right",value:"align_right"}])})),label({className:"horiz_input"},span({className:"label_text"},"Fixed"),div({},input({type:"checkbox",name:this.props.input_name_prefix?this.props.input_name_prefix+"[attach]":void 0,value:"fixed",checked:"fixed"===((ref2=this.props.params)!=null?ref2.attach:void 0),onChange:this.props.on_change?this.set_attach||(this.set_attach=function(_this){return function(e){var attach;attach=e.target.checked?"fixed":null;return _this.update_params({attach:attach})}}(this)):void 0})))):void 0)}})})}).call(this);
